# rails-vue

## 環境構築手順
```
1,git clone git@github.com:hayaki821/vue-rails-julia.git を行う
2,cd vue-rails-julia (vue-rails-juliaまで移動)
3,yarn add vue@next vue-loader@next @vue/compiler-sfc
4,yarn add vue-router@^4
5,yarn add axios --save
6,docker-compose up
7,http://localhost:8080 または http://localhost:8080/satori/julia にアクセス

tar.gzを解凍した場合1,3,4,5をスキップする
```
## アプリケーションの概要
```
1,環境構築後docker-compose upでlocalhost:8080でホーム画面にアクセスできるようになる。その後「julia集合生成ページへ」をクリックでhttp://localhost:8080/satori/julia へアクセスできるようになる。
2,http://localhost:8080/satori/julia へアクセスしフロント側でジュリア集合作成に必要なパラメータを受け取るフォームがあるので値を自由に入力する。（デフォルト値が入ってます。）
3,「ジュリア集合を生成する」ボタンを押下するとフォームのパラメータがバックエンドに送られる。
4,バックエンドが受け取ったパラメータをジュリア集合生成クラスで処理し、ジュリア集合をrgba値としてフロント側に返す。
5,フロント側で受け取ったrgba値をキャンバスを用いてジュリア集合の描画を行う。（フォームの下に描画される。）
```

## julia集合生成のルール
```
・複素漸化式の計算回数の境界値を100回とした。計算回数が100回を超えたら収束するとみなし黒色で表示。計算回数が100回に近づくほど赤色ぽく表示し、0回に近いほど強い青色で表示される。緑要素は今回は使わなかった。計算の過程で小数点以下も出てくるがすべて四捨五入し、整数でrgb値を返している。
また色味付の式は
赤: (計算回数/100)^0.3*255,
緑:0,
青: ((1-計算回数)/100)^0.3*255
```

## 初めて挑戦したこと
```
・ruby,railsを用いた開発
・vue3の導入（vue2までの開発経験はあった）
・dockerでvue3,rails6の環境を構築したこと
・アトミックデザインをフロント側で取り入れた(Atom,Template以外)
・Materializeの導入
```

## 特に見てほしいところ、工夫したこと
```
（バック）
・rails側ではジュリア集合の作成のみを行いそれを返すAPIとし、フロントで描画を行うことで描画速度を早めようとしたことが特に工夫できたところです。今回はDBに保存する必要なども特にないことなどから、わざわざバックエンドで描画まで行い画像を作る必要がないと考えました。また、バックエンドでジュリア集合の描画（画像を作成）までを行いフロントに返す処理だととても重くなりそうだったことも考慮しました。rails側での計算速度は遅いということもあり、描画はcanvasを用いることで少しは処理速度が上がったと思います。

・DB,modelを作成をしない方針で進めたためmodelのバリデーションを使わず自作でバリデーションを作成しました。modelを作成するほうが楽だと思いましたが、DBを立ち上げない状態だとうまくいかないのではないかと考えmodelは作成しないことにしました。またDBを立ち上げないことで速度も早くなると考えdocker環境上にもDBを立ち上げずに、データベースを利用しないアプリケーションとして作成しました。

・Fat Controllerを防ぐためにservice層を導入し、複雑な処理をservice層に記載しました。複雑な処理をを切り離すことで責任範囲を明確にし、修正をしやすく他人が見てわかりやすいといったメリットがあると思ったのでservice層を導入しました。

・csrf tokenでのエラーをなくしました。

（フロント）
・ローディングを実装しました。ジュリア集合の生成までにある程度の時間がかるので不具合が発生しないように通信が終わるまでのローディングを実装し、ボタンの連打ができないようにしました。

・CreateJuliaForm.vueで各ジュリア集合用パラメーターの入力フォームを作成する必要がありましたが、1つずつ作成するのではなくfor文を使いながら効率よくかつコード量が減るように作成しました。また入力フォームは共通で使い回せる上にmoleculesとしての役割があると考えたためコンポーネント化しました。その他のボタンなども含めAtomも作り、さらに細かくコンポーネント化するか迷いましたが逆に見にくくなりそうだったためAtomまでは作りませんでした。

（共通）
・変数名や関数名をできるだけわかりやすい名前をつけるようにしました。また、英語でコメントを残しながら読みやすくなるように心がけました。
```

## 今後の方針
```
・typescriptの導入
・有効桁数のバリデーションの実装
・パラメータの入力可能な範囲を制限するバリデーションの実装
・rails側でジュリア集合生成のための計算を高速化
・スタイルをもう少しつける
・フロント、バックそれぞれのアンチパターンがあればそれらを改善する
・テストを行えるようにする
```

